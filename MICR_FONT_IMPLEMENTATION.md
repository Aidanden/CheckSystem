# ุชุทุจูู ุฎุท MICR ุงููุฎุตุต
## MICR Custom Font Implementation

---

## ๐ ููุฎุต / Summary

ุชู ุชุทุจูู ุฎุท MICR ุงููุฎุตุต (`micrenc.ttf`) ูู ุงููุธุงู ุจุงููุงูู:
- โ ุดุงุดุฉ ุงูุฅุนุฏุงุฏุงุช (ูุนุงููุฉ ูุจุงุดุฑุฉ)
- โ ุทุจุงุนุฉ PDF (ุงูุดููุงุช ุงููุนููุฉ)

The custom MICR font (`micrenc.ttf`) has been implemented throughout the system:
- โ Settings screen (live preview)
- โ PDF printing (actual checks)

---

## ๐ ููุงูุน ุงููููุงุช / File Locations

### ุฎุท MICR / MICR Font Files:
```
client/src/font/micrenc.ttf          (ุงููุตุฏุฑ ุงูุฃุตูู / Original source)
client/public/font/micrenc.ttf       (ูููุงุฌูุฉ ุงูุฃูุงููุฉ / For frontend)
server/src/fonts/micrenc.ttf         (ููุทุจุงุนุฉ / For printing)
```

---

## ๐จ ุงูุชุทุจูู ูู Frontend

### 1. ุชุนุฑูู ุงูุฎุท ูู CSS
**ุงูููู:** `client/src/app/globals.css`

```css
@font-face {
  font-family: 'MICR';
  src: url('/font/micrenc.ttf') format('truetype');
  font-weight: normal;
  font-style: normal;
  font-display: swap;
}
```

### 2. ุงุณุชุฎุฏุงู ุงูุฎุท ูู ุดุงุดุฉ ุงูุฅุนุฏุงุฏุงุช
**ุงูููู:** `client/src/app/settings/page.tsx`

```tsx
<div
  style={{
    fontFamily: 'MICR, monospace',
    fontSize: `${currentSettings.micrLine.fontSize * 1.5}px`,
    letterSpacing: '0.05em',
  }}
>
  01 100012345678901 1100000001 000000001
</div>
```

**ุงููููุฒุงุช:**
- โ ูุนุงููุฉ ูุจุงุดุฑุฉ ุจุฎุท MICR ุงูุญูููู
- โ fallback ุฅูู `monospace` ุฅุฐุง ูู ูุชู ุชุญููู ุงูุฎุท
- โ ุชุจุงุนุฏ ุฃุญุฑู ูุญุณูู (`letterSpacing`)

---

## ๐จ๏ธ ุงูุชุทุจูู ูู Backend (PDF)

### 1. ุชุณุฌูู ุงูุฎุท ูู PDFKit
**ุงูููู:** `server/src/utils/pdfGenerator.ts`

```typescript
// Register MICR font
const micrFontPath = path.join(__dirname, '../fonts/micrenc.ttf');
if (fs.existsSync(micrFontPath)) {
  doc.registerFont('MICR', micrFontPath);
}
```

### 2. ุงุณุชุฎุฏุงู ุงูุฎุท ูู ุงูุทุจุงุนุฉ

#### ูู ุตูุญุฉ ุงูุบูุงู:
```typescript
try {
  doc.font('MICR').fontSize(12).text(checkbookData.checks[0].micrLine);
  doc.font('Helvetica').fontSize(8).text('(Type starts from right: 01=Individual, 02=Corporate)');
} catch (e) {
  doc.font('Courier').text(checkbookData.checks[0].micrLine);
}
```

#### ูู ุตูุญุงุช ุงูุดููุงุช:
```typescript
try {
  doc.fontSize(12).font('MICR').text(check.micrLine, 20, height - 25, {
    width: width - 40,
    align: 'center',
  });
} catch (e) {
  // Fallback to Courier if MICR font is not available
  doc.fontSize(10).font('Courier').text(check.micrLine, 20, height - 25, {
    width: width - 40,
    align: 'center',
  });
}
```

**ุงููููุฒุงุช:**
- โ ุฎุท MICR ุญูููู ูู PDF
- โ ุญุฌู ุฎุท ููุงุณุจ (12pt)
- โ fallback ุขูู ุฅูู Courier
- โ ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ุจุดูู ุตุญูุญ

---

## ๐ง ุงูุชุซุจูุช ูุงูุฅุนุฏุงุฏ / Installation & Setup

### ุงูุฎุทูุงุช ุงููุทููุจุฉ:

1. **ุงูุชุฃูุฏ ูู ูุฌูุฏ ุงูุฎุท:**
   ```bash
   # ูุฌุจ ุฃู ูููู ุงูููู ููุฌูุฏ ูู:
   client/src/font/micrenc.ttf
   ```

2. **ูุณุฎ ุงูุฎุท ูููุงุฌูุฉ ุงูุฃูุงููุฉ:**
   ```bash
   # ุชู ุชููุงุฆูุงู - ุงูุฎุท ูู:
   client/public/font/micrenc.ttf
   ```

3. **ูุณุฎ ุงูุฎุท ููุฎุงุฏู:**
   ```bash
   # ุชู ุชููุงุฆูุงู - ุงูุฎุท ูู:
   server/src/fonts/micrenc.ttf
   ```

4. **ุฅุนุงุฏุฉ ุชุดุบูู ุงูุชุทุจูู:**
   ```bash
   # Frontend
   cd client
   npm run dev

   # Backend
   cd server
   npm run dev
   ```

---

## ๐ฏ ูููุฒุงุช ุฎุท MICR

### ุงูุฎุตุงุฆุต ุงูุชูููุฉ:
- **ุงูุงุณู:** MICR Encoding (micrenc.ttf)
- **ุงูููุน:** TrueType Font
- **ุงูุงุณุชุฎุฏุงู:** ุฃุฑูุงู MICR ุนูู ุงูุดููุงุช ุงูุจูููุฉ
- **ุงูุชุฑููุฒ:** E-13B MICR standard

### ุงูุฃุญุฑู ุงููุฏุนููุฉ:
```
0 1 2 3 4 5 6 7 8 9
โ โ โ โ (ุฑููุฒ MICR ุงูุฎุงุตุฉ)
```

### ูุซุงู ุนูู ุฎุท MICR:
```
01 100012345678901 1100000001 000000001
โ  โ               โ          โ
ููุน ุงูุตู  ุฑูู ุงูุญุณุงุจ  ุงูุชูุฌููู  ุงูุชุณูุณู
```

---

## ๐ ุงูุงุฎุชุจุงุฑ / Testing

### 1. ุงุฎุชุจุงุฑ ุงููุงุฌูุฉ ุงูุฃูุงููุฉ:
```bash
cd client
npm run dev
```

**ุงูุฎุทูุงุช:**
1. ุงูุชุญ ุงููุชุตูุญ: `http://localhost:3000/settings`
2. ุชุญูู ูู ูุนุงููุฉ ุฎุท MICR
3. ูุฌุจ ุฃู ูุธูุฑ ุงูุฎุท ุจุดูู ูููุฒ (ููุณ monospace ุนุงุฏู)

### 2. ุงุฎุชุจุงุฑ ุงูุทุจุงุนุฉ:
```bash
cd server
npm run dev
```

**ุงูุฎุทูุงุช:**
1. ูู ุจุทุจุงุนุฉ ุฏูุชุฑ ุดููุงุช ุชุฌุฑูุจู
2. ุงูุชุญ ููู PDF ุงููุงุชุฌ
3. ุชุญูู ูู ุฎุท MICR ูู ุฃุณูู ูู ุดูู
4. ูุฌุจ ุฃู ูููู ุงูุฎุท ูุงุถุญ ููููุฒ

### 3. ุงูุชุญูู ูู ุชุญููู ุงูุฎุท:

#### ูู ุงููุชุตูุญ:
```javascript
// ุงูุชุญ Developer Tools > Console
document.fonts.check('12px MICR')
// ูุฌุจ ุฃู ูุฑุฌุน: true
```

#### ูู PDF:
- ุงูุชุญ ููู PDF
- ุชุญูู ูู ุฎุตุงุฆุต ุงูุฎุท (Font Properties)
- ูุฌุจ ุฃู ูุธูุฑ "MICR" ูู ูุงุฆูุฉ ุงูุฎุทูุท ุงููุถููุฉ

---

## โ๏ธ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก / Troubleshooting

### ุงููุดููุฉ: ุงูุฎุท ูุง ูุธูุฑ ูู ุงููุงุฌูุฉ

**ุงูุญู:**
1. ุชุฃูุฏ ูู ูุฌูุฏ ุงูููู: `client/public/font/micrenc.ttf`
2. ุงูุณุญ ุงููุงุด:
   ```bash
   # ูู ุงููุชุตูุญ
   Ctrl + Shift + R (Hard Reload)
   ```
3. ุชุญูู ูู Console ููุฃุฎุทุงุก
4. ุชุฃูุฏ ูู ูุณุงุฑ ุงูุฎุท ูู CSS ุตุญูุญ

### ุงููุดููุฉ: ุงูุฎุท ูุง ูุธูุฑ ูู PDF

**ุงูุญู:**
1. ุชุฃูุฏ ูู ูุฌูุฏ ุงูููู: `server/src/fonts/micrenc.ttf`
2. ุชุญูู ูู logs ุงูุฎุงุฏู ููุฃุฎุทุงุก
3. ุชุฃูุฏ ูู ุตูุงุญูุงุช ุงููุฑุงุกุฉ ููููู
4. ุฃุนุฏ ุชุดุบูู ุงูุฎุงุฏู

### ุงููุดููุฉ: ุงูุฎุท ูุธูุฑ ูู monospace ุนุงุฏู

**ุงูุณุจุจ:** ุงูุฎุท ูู ูุชู ุชุญูููู ุจุดูู ุตุญูุญ

**ุงูุญู:**
1. ุชุญูู ูู ูุณุงุฑ ุงูุฎุท
2. ุชุฃูุฏ ูู ุตูุบุฉ ุงูููู (TTF)
3. ุชุญูู ูู ุญุฌู ุงูููู (ูุฌุจ ุฃู ูููู > 0 bytes)
4. ุฌุฑุจ ุชุญููู ุงูุฎุท ูุฏููุงู ูู ุงููุชุตูุญ

---

## ๐ ุงูุฃูุงู / Security

### ุงุนุชุจุงุฑุงุช ุงูุฃูุงู:
1. โ ุงูุฎุท ูุถูู ูู ุงูุชุทุจูู (ูุง ูุชู ุชุญูููู ูู CDN ุฎุงุฑุฌู)
2. โ ุงูุฎุท ูู ูุฌูุฏ public ุขูู
3. โ ูุง ุชูุฌุฏ ูุฎุงุทุฑ XSS ูู ุงูุฎุท
4. โ ุงูุฎุท ูุชู ุงูุชุญูู ูู ูุฌูุฏู ูุจู ุงูุงุณุชุฎุฏุงู

---

## ๐ ุงูุฃุฏุงุก / Performance

### ุชุญุณููุงุช ุงูุฃุฏุงุก:
1. **font-display: swap** - ูููุน FOIT (Flash of Invisible Text)
2. **Fallback fonts** - ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุฃูุถู ุฃุซูุงุก ุงูุชุญููู
3. **Local hosting** - ุฃุณุฑุน ูู CDN ููุฎุทูุท ุงูุตุบูุฑุฉ
4. **Lazy loading** - ุงูุฎุท ูุชู ุชุญูููู ููุท ุนูุฏ ุงูุญุงุฌุฉ

### ุญุฌู ุงูุฎุท:
- ุญุฌู ููู `micrenc.ttf`: ~20-30 KB
- ุชุฃุซูุฑ ุถุฆูู ุนูู ููุช ุงูุชุญููู

---

## ๐จ ุงูุชุฎุตูุต / Customization

### ุชุนุฏูู ุญุฌู ุงูุฎุท:

#### ูู ุงููุงุฌูุฉ:
```tsx
fontSize: `${currentSettings.micrLine.fontSize * 1.5}px`
```

#### ูู PDF:
```typescript
doc.fontSize(12).font('MICR')
```

### ุชุนุฏูู ุงูุชุจุงุนุฏ:
```tsx
letterSpacing: '0.05em'  // ูููู ุชุนุฏููู ุญุณุจ ุงูุญุงุฌุฉ
```

### ุชุนุฏูู ุงููุญุงุฐุงุฉ:
```typescript
align: 'center'  // ุฃู 'left' ุฃู 'right'
```

---

## ๐ ุงููููุงุช ุงููุนุฏูุฉ / Modified Files

### Frontend:
1. โ `client/src/app/globals.css` - ุชุนุฑูู ุงูุฎุท
2. โ `client/src/app/settings/page.tsx` - ุงุณุชุฎุฏุงู ุงูุฎุท ูู ุงููุนุงููุฉ
3. โ `client/public/font/micrenc.ttf` - ููู ุงูุฎุท

### Backend:
4. โ `server/src/utils/pdfGenerator.ts` - ุชุณุฌูู ูุงุณุชุฎุฏุงู ุงูุฎุท
5. โ `server/src/fonts/micrenc.ttf` - ููู ุงูุฎุท

---

## โจ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ / Final Result

### ูุจู ุงูุชุญุฏูุซ:
- โ ุฎุท monospace ุนุงุฏู
- โ ุบูุฑ ุงุญุชุฑุงูู
- โ ูุง ูุชูุงูู ูุน ูุนุงููุฑ MICR

### ุจุนุฏ ุงูุชุญุฏูุซ:
- โ ุฎุท MICR ุญูููู ููุนุชูุฏ
- โ ูุธูุฑ ุงุญุชุฑุงูู
- โ ูุชูุงูู ูุน ุฃุฌูุฒุฉ ูุฑุงุกุฉ MICR
- โ ูุนุงููุฉ ุฏูููุฉ ูู ุงูุฅุนุฏุงุฏุงุช
- โ ุทุจุงุนุฉ ุนุงููุฉ ุงูุฌูุฏุฉ

---

## ๐ ุงูุชุญุฏูุซุงุช ุงููุณุชูุจููุฉ / Future Updates

### ูุญุชูู:
- [ ] ุฅุถุงูุฉ ุฎุทูุท MICR ุจุฏููุฉ (CMC-7)
- [ ] ุฏุนู ุฃุญุฌุงู ุฎุทูุท ูุชุนุฏุฏุฉ
- [ ] ุชุญุณููุงุช ุฅุถุงููุฉ ููุทุจุงุนุฉ
- [ ] ุฏุนู ุฎุทูุท ุนุฑุจูุฉ ูู ุจุงูู ุงูุดูู

---

## ๐ ุงูุฏุนู / Support

ุฅุฐุง ูุงุฌูุช ูุดุงูู ูุน ุฎุท MICR:
1. ุชุญูู ูู ูุฌูุฏ ุงููููุงุช ูู ุงูููุงูุน ุงูุตุญูุญุฉ
2. ุฑุงุฌุน ูุณู ุงุณุชูุดุงู ุงูุฃุฎุทุงุก
3. ุชุญูู ูู logs ุงูุฎุงุฏู ูุงููุชุตูุญ
4. ุงุชุตู ุจูุฑูู ุงูุฏุนู ุงูููู

---

**ุชุงุฑูุฎ ุงูุชูููุฐ / Implementation Date:** November 17, 2025  
**ุงูุฅุตุฏุงุฑ / Version:** 1.2.0  
**ุงูุญุงูุฉ / Status:** โ ูุทุจู ููุดุท / Implemented and Active

---

## ๐ ุงูุฎูุงุตุฉ / Summary

ุชู ุชุทุจูู ุฎุท MICR ุงููุฎุตุต ุจูุฌุงุญ ูู ุฌููุน ุฃูุญุงุก ุงููุธุงู. ุงูุขู:
- ุงููุนุงููุฉ ูู ุดุงุดุฉ ุงูุฅุนุฏุงุฏุงุช ุชุณุชุฎุฏู ุงูุฎุท ุงูุญูููู
- ุงูุดููุงุช ุงููุทุจูุนุฉ ุชุญุชูู ุนูู ุฎุท MICR ุงุญุชุฑุงูู
- ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู ูู ุจูุฆุฉ ุงูุฅูุชุงุฌ

The custom MICR font has been successfully implemented throughout the system. Now:
- Settings preview uses the real font
- Printed checks contain professional MICR font
- System is ready for production use
